# AI 圓桌 (AI Roundtable) 測試計劃

> 版本：1.2 | 最後更新：2026-01-25

---

## 1. 測試概述

### 1.1 測試目標

驗證 AI 圓桌擴充功能的所有核心功能正確運作，包括：
- 多 AI 平台連線管理
- 訊息傳送與回覆擷取
- 一般模式指令解析與執行
- 討論模式完整流程
- 使用者介面互動
- 資料儲存與訊息通訊

### 1.2 測試範圍

| 範圍 | 包含 | 不包含 |
|------|------|--------|
| 功能測試 | Side Panel、Background Script、Content Scripts | AI 平台內部邏輯 |
| 整合測試 | 元件間通訊、訊息路由 | 第三方 API |
| UI 測試 | 介面互動、狀態顯示 | 視覺美觀度 |
| 邊界測試 | 極限條件、錯誤處理 | 效能壓力測試 |
| 資料儲存測試 | chrome.storage.local/session | 外部資料庫 |
| 訊息通訊測試 | Background ↔ Content ↔ SidePanel 訊息 | 網路請求 |

### 1.3 測試環境

- **瀏覽器**：Chrome 最新穩定版
- **作業系統**：macOS / Windows / Linux
- **AI 平台**：
  - Claude (https://claude.ai)
  - ChatGPT (https://chat.openai.com 或 https://chatgpt.com)
  - Gemini (https://gemini.google.com)

---

## 2. 測試邊界分析

### 2.1 輸入邊界

#### 2.1.1 訊息輸入

| 邊界條件 | 有效值 | 無效值 |
|----------|--------|--------|
| 訊息長度 | 1 ~ 10000 字元 | 空白、超過 10000 字元 |
| 特殊字元 | 中英文、標點符號、Emoji | - |
| XML 標籤 | `<tag>content</tag>` | 未閉合標籤（應容錯處理） |
| @ 提及 | `@Claude`, `@ChatGPT`, `@Gemini` | `@Unknown`, `@` 單獨使用, `@GPT4` |

#### 2.1.2 動作選單

| 動作 | 類型 | 預期行為 |
|------|------|----------|
| 互評 | mutual | 直接執行（使用勾選的 AI） |
| 請 Claude 評價... | ask | 開啟 Modal 選擇來源 |
| 請 ChatGPT 評價... | ask | 開啟 Modal 選擇來源 |
| 請 Gemini 評價... | ask | 開啟 Modal 選擇來源 |
| 指定來源評價 | advanced | 開啟進階 Modal |

#### 2.1.3 評價語氣

| 語氣 | 對應提示 |
|------|----------|
| 綜合評價 (general) | 請綜合評價以上觀點... |
| 指出優點 (pros) | 請指出以上回覆中值得學習的優點... |
| 指出問題 (cons) | 請指出以上回覆中的問題... |
| 補充說明 (add) | 請補充以上回覆中遺漏的內容... |
| 觀點對比 (compare) | 請對比以上觀點與你的看法... |

#### 2.1.4 討論模式

| 邊界條件 | 有效值 | 無效值 |
|----------|--------|--------|
| 參與者數量 | 恰好 2 個 | 0, 1, 3 個 |
| 討論主題 | 1 ~ 1000 字元 | 空白 |
| 輪次數量 | 1 ~ 無上限 | 0 |

### 2.2 狀態邊界

#### 2.2.1 連線狀態

| 狀態 | 條件 | 預期行為 |
|------|------|----------|
| 已連線 | AI 分頁已開啟且 Content Script 就緒 | 顯示「已連線」，可傳送訊息 |
| 未連線 | AI 分頁未開啟或 Content Script 失效 | 顯示「未找到」，傳送失敗 |
| 部分連線 | 部分 AI 已連線 | 僅對已連線的 AI 傳送 |
| 上下文失效 | 擴充功能重載後 | 需重新整理分頁恢復 |

#### 2.2.2 串流狀態

| 狀態 | 條件 | 預期行為 |
|------|------|----------|
| 串流中 | AI 正在產生回覆 | 等待完成，不擷取 |
| 串流完成 | 內容穩定 N 次 | 擷取回覆內容 |
| 逾時 | 等待超過 10 分鐘 | 中止等待，記錄逾時 |

### 2.3 輸出邊界

#### 2.3.1 回覆擷取

| 邊界條件 | 預期行為 |
|----------|----------|
| 正常回覆 | 完整擷取 Markdown 內容 |
| 空回覆 | 回傳 null 或空字串 |
| 超長回覆 | 完整擷取不截斷 |
| 含程式碼 | 保留格式和語法高亮標記 |
| 含圖片/圖表 | 略過圖片，僅擷取文字 |
| Claude Thinking Block | 過濾思考區塊，僅取最終答案 |

#### 2.3.2 日誌輸出

| 事件 | 預期日誌格式 |
|------|--------------|
| 傳送成功 | `HH:MM:SS 已傳送至 {aiType}` |
| 傳送失敗 | `HH:MM:SS 傳送失敗: {error}` |
| 回覆擷取 | `HH:MM:SS {aiType} 回覆已擷取` |
| 等待逾時 | `HH:MM:SS 等待回覆逾時` |

### 2.4 資料儲存邊界

#### 2.4.1 chrome.storage.local

| 項目 | 預期行為 |
|------|----------|
| 設定保存 | 勾選狀態持久化 |
| 瀏覽器重啟 | 設定恢復 |

#### 2.4.2 chrome.storage.session

| 項目 | 預期行為 |
|------|----------|
| 回覆暫存 | 擷取的回覆儲存 |
| 工作階段結束 | 自動清除 |

### 2.5 訊息通訊邊界

| 訊息類型 | 發送方 | 接收方 | 預期行為 |
|----------|--------|--------|----------|
| CONTENT_SCRIPT_READY | Content | Background | 更新分頁狀態 |
| TAB_STATUS_UPDATE | Background | SidePanel | 更新 UI 狀態 |
| SEND_MESSAGE | SidePanel | Content | 注入訊息 |
| RESPONSE_CAPTURED | Content | SidePanel | 通知擷取完成 |

---

## 3. 測試類型與策略

### 3.1 手動測試

由於此專案為 Chrome 擴充功能，需要實際操作 AI 平台網頁，以下測試須由人工執行：

1. **端對端功能測試** - 驗證完整使用者流程
2. **UI 互動測試** - 驗證介面互動行為
3. **相容性測試** - 驗證跨平台相容性

### 3.2 半自動測試

可透過 Chrome DevTools Console 執行的測試：

1. **訊息解析測試** - 驗證 `parseMessage()` 函式
2. **URL 判斷測試** - 驗證 `getAITypeFromUrl()` 函式
3. **狀態管理測試** - 驗證 `discussionState` 狀態轉換

---

## 4. 測試優先級

| 優先級 | 測試領域 | 理由 |
|--------|----------|------|
| P0 (最高) | 訊息傳送/接收 | 核心功能 |
| P0 | 連線狀態偵測 | 使用前提 |
| P1 | 指令解析 | 主要功能 |
| P1 | 討論模式流程 | 主要功能 |
| P2 | UI 互動 | 使用者體驗 |
| P2 | 錯誤處理 | 穩定性 |
| P3 | 邊界條件 | 健壯性 |

---

## 5. 測試風險與假設

### 5.1 風險

| 風險 | 影響 | 緩解措施 |
|------|------|----------|
| AI 平台 DOM 變更 | Content Script 失效 | 定期檢查選擇器 |
| AI 平台登入狀態失效 | 無法傳送訊息 | 測試前確認登入 |
| 串流偵測不穩定 | 擷取不完整 | 增加穩定門檻 |

### 5.2 假設

- 測試執行時需登入所有目標 AI 平台
- 測試環境有穩定的網路連線
- 擴充功能已正確載入

---

## 6. 驗證方法

### 6.1 手動驗證步驟

1. **載入擴充功能**
   - Chrome → `chrome://extensions/` → 開發人員模式 → 載入未封裝項目
   - 選擇專案目錄 `/Users/huangwei/Project/ai-roundtable`

2. **開啟側邊欄**
   - 點擊擴充功能圖示開啟 Side Panel

3. **開啟 AI 平台分頁**
   - 開啟 Claude、ChatGPT、Gemini 各一個分頁
   - 確認皆已登入

4. **驗證連線狀態**
   - 側邊欄應顯示三個 AI 皆「已連線」

5. **執行測試案例**
   - 依據 `test-cases.md` 逐一執行

### 6.2 Console 測試

在 Side Panel 的 DevTools Console 中執行：

```javascript
// 測試訊息解析
parseMessage('/mutual 評價一下')
parseMessage('@Claude 評價一下 @ChatGPT')
parseMessage('/cross @Claude <- @ChatGPT 對比一下')
```

---

## 7. 參考文件

- [技術規格文件](./spec.md)
- [測試案例](./test-cases.md)
